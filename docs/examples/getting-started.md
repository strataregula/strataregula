# Getting Started Examples

This guide provides practical examples to get you started with Strataregula.

## Basic Configuration Processing

### Example 1: Simple Pattern Expansion

Create a basic configuration file:

```yaml
# config.yaml
services:
  - name: "edge.tokyo.gateway"
  - name: "edge.osaka.gateway"  
  - name: "edge.*.proxy"
  - name: "api.*.service"

regions:
  tokyo: "kanto"
  osaka: "kansai"
```

Compile the configuration:

```bash
sr compile config.yaml --output expanded.py --format python
```

Generated Python code:

```python
# expanded.py - Generated by Strataregula
from typing import Dict, List, Optional

# Expanded services (47 total from wildcards)
SERVICES = [
    "edge.tokyo.gateway",
    "edge.osaka.gateway", 
    "edge.hokkaido.proxy",
    "edge.aomori.proxy",
    # ... all 47 prefectures
    "api.tokyo.service",
    "api.osaka.service",
    # ... all prefectures
]

def lookup_service(pattern: str) -> List[str]:
    """O(1) service lookup by pattern."""
    service_map = {
        "edge.tokyo.gateway": ["edge.tokyo.gateway"],
        "edge.*.proxy": [s for s in SERVICES if s.startswith("edge.") and s.endswith(".proxy")],
        # ... optimized lookups
    }
    return service_map.get(pattern, [])
```

### Example 2: JSON Output Format

```bash
sr compile config.yaml --output expanded.json --format json
```

```json
{
  "metadata": {
    "generated_by": "strataregula v0.1.1",
    "timestamp": "2025-08-25T10:30:00Z",
    "input_file": "config.yaml"
  },
  "services": [
    "edge.tokyo.gateway",
    "edge.osaka.gateway",
    "edge.hokkaido.proxy"
  ],
  "patterns": {
    "edge.*.gateway": ["edge.tokyo.gateway", "edge.osaka.gateway"],
    "edge.*.proxy": ["edge.hokkaido.proxy", "edge.aomori.proxy"]
  },
  "statistics": {
    "total_patterns": 4,
    "expanded_services": 94,
    "compilation_time_ms": 15
  }
}
```

### Example 3: Planning Mode

Preview expansion without generating files:

```bash
sr compile config.yaml --plan
```

Output:
```
üìã Compilation Plan
==================
Input: config.yaml
Patterns to expand: 4
Expected services: ~94

Pattern Analysis:
‚úì edge.tokyo.gateway ‚Üí 1 service (literal)
‚úì edge.osaka.gateway ‚Üí 1 service (literal)  
‚úì edge.*.proxy ‚Üí 47 services (wildcard: 47 prefectures)
‚úì api.*.service ‚Üí 47 services (wildcard: 47 prefectures)

Memory estimate: ~15MB
Compilation time estimate: ~20ms
```

## DOE Runner Plugin Examples

### Example 4: Basic Experiment Execution

Create experiment cases:

```csv
# cases.csv
case_id,backend,cmd_template,timeout_s,seed,retries,expected_p95,threshold_p95
test-01,shell,"echo 'p95=0.05 p99=0.08 throughput_rps=1000'",10,42,2,0.05,0.06
test-02,dummy,"dummy load test",10,123,1,0.08,0.10
test-03,shell,"python simulate.py --seed {seed}",30,456,0,0.12,0.15
```

Run experiments:

```bash
# Using DOE Runner plugin
python -c "
from strataregula_doe_runner.plugin import DOERunnerPlugin

plugin = DOERunnerPlugin()
result = plugin.execute_cases(
    cases_path='cases.csv',
    metrics_path='metrics.csv',
    max_workers=2,
    verbose=True
)

print(f'Status: {result[\"status\"]}')
print(f'Exit code: {result[\"exit_code\"]}')
print(f'Stats: {result[\"stats\"]}')
"
```

Generated metrics output:

```csv
# metrics.csv
case_id,status,run_seconds,p95,p99,throughput_rps,errors,ts_start,ts_end
test-01,OK,0.12,0.05,0.08,1000,0,2025-08-25T10:30:00,2025-08-25T10:30:01
test-02,OK,0.05,0.08,0.12,800,0,2025-08-25T10:30:01,2025-08-25T10:30:02
test-03,FAIL,30.0,,,0,1,2025-08-25T10:30:02,2025-08-25T10:30:32
```

### Example 5: Parallel Execution

```bash
# CLI usage
srd run --cases cases.csv --out metrics.csv --max-workers 4 --verbose
```

### Example 6: Threshold Validation

Create cases with thresholds:

```csv
case_id,backend,cmd_template,timeout_s,threshold_p95,threshold_p99
perf-01,shell,"benchmark --load light",60,0.10,0.15
perf-02,shell,"benchmark --load heavy",120,0.50,0.80
```

The plugin will return exit code 2 if thresholds are violated:

```python
result = plugin.execute_cases(cases_path="perf_cases.csv")
if result['exit_code'] == 2:
    print("‚ö†Ô∏è  Performance thresholds violated")
    for violation in result['stats']['threshold_violations']:
        print(f"  - {violation}")
```

## Pipeline Examples

### Example 7: Data Processing Pipeline

Create a processing pipeline:

```bash
strataregula create data-processor \
  --description "Process user configurations" \
  --input-format yaml \
  --output-format json \
  --command "filter:condition='user.active'" \
  --command "transform:expression='data.users'" \
  --save pipeline.yaml
```

Generated pipeline:

```yaml
# pipeline.yaml
name: "data-processor"
description: "Process user configurations"
input_format: "yaml"
output_format: "json"
commands:
  - name: "filter"
    params:
      condition: "user.active"
  - name: "transform"
    params:
      expression: "data.users"
```

Use the pipeline:

```bash
# Process data through pipeline
strataregula run data-processor users.yaml --output processed.json
```

### Example 8: Configuration Validation Pipeline

```bash
strataregula create config-validator \
  --command "validate:schema='schema.yaml'" \
  --command "transform:expression='data if data.valid else None'" \
  --save validator.yaml
```

```bash
# Validate configuration
cat config.yaml | strataregula run config-validator --stdin
```

## Advanced Examples

### Example 9: Custom Plugin Integration

```python
# custom_plugin.py
class CustomPlugin:
    name = "custom_processor"
    version = "0.1.0"
    description = "Custom data processor"
    
    def get_info(self):
        return {
            "name": self.name,
            "version": self.version,
            "supported_commands": ["process_data", "validate_data"]
        }
    
    def process_data(self, input_path, output_path, **kwargs):
        # Custom processing logic
        with open(input_path, 'r') as f:
            data = yaml.safe_load(f)
        
        # Process data
        processed = self.custom_transform(data)
        
        with open(output_path, 'w') as f:
            yaml.dump(processed, f)
        
        return {
            'status': 'success',
            'processed_items': len(processed)
        }

def create_plugin():
    return CustomPlugin()
```

Register in `pyproject.toml`:

```toml
[project.entry-points."strataregula.plugins"]
"custom_processor" = "custom_plugin:CustomPlugin"
```

### Example 10: Large Scale Processing

Process large configurations efficiently:

```bash
# Use memory limits and streaming
sr compile large_config.yaml \
  --output large_output.py \
  --format python \
  --memory-limit 500 \
  --enable-statistics \
  --cache-size 256
```

Monitor performance:

```bash
# Enable detailed statistics
sr compile config.yaml --stats --verbose
```

Output:
```
üìä Compilation Statistics
========================
Input patterns: 15
Expanded services: 1,247
Cache hits: 89%
Memory usage: 45MB peak
Compilation time: 156ms
Generated code size: 2.1MB
```

## Integration Examples

### Example 11: CI/CD Integration

```yaml
# .github/workflows/config-validation.yml
name: Configuration Validation

on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'
      
      - name: Install Strataregula
        run: |
          pip install strataregula
          pip install strataregula-doe-runner
      
      - name: Validate configurations
        run: |
          sr compile configs/*.yaml --format json --plan
      
      - name: Run experiments
        run: |
          srd run --cases test_cases.csv --dry-run
```

### Example 12: Docker Integration

```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY configs/ ./configs/
COPY cases.csv .

# Compile configurations
RUN sr compile configs/main.yaml --output generated.py --format python

# Run experiments
CMD ["srd", "run", "--cases", "cases.csv", "--out", "results.csv"]
```

### Example 13: Monitoring Integration

```python
# monitoring.py
import time
from strataregula_doe_runner.plugin import DOERunnerPlugin

def run_with_monitoring():
    plugin = DOERunnerPlugin()
    
    start_time = time.time()
    result = plugin.execute_cases(
        cases_path="cases.csv",
        metrics_path="metrics.csv",
        verbose=True
    )
    duration = time.time() - start_time
    
    # Send metrics to monitoring system
    metrics = {
        'execution_duration': duration,
        'exit_code': result['exit_code'],
        'success_rate': result['stats']['successful'] / result['stats']['total_cases'],
        'threshold_violations': len(result['stats']['threshold_violations'])
    }
    
    send_to_prometheus(metrics)
    
    return result

def send_to_prometheus(metrics):
    # Integration with Prometheus metrics
    pass
```

## Troubleshooting Examples

### Example 14: Debug Mode

```bash
# Enable verbose logging
sr compile config.yaml --verbose --debug

# Check plugin status
python -c "
from strataregula_doe_runner.plugin import DOERunnerPlugin
plugin = DOERunnerPlugin()
print(plugin.get_info())
"
```

### Example 15: Error Recovery

```python
# error_recovery.py
def safe_execution():
    try:
        from strataregula.core.compiler import ConfigCompiler
        from strataregula.core.config import CompilationConfig
        
        config = CompilationConfig(
            input_path="config.yaml",
            output_path="output.py"
        )
        
        compiler = ConfigCompiler(config)
        result = compiler.compile()
        
        return result
        
    except Exception as e:
        print(f"Compilation failed: {e}")
        
        # Fallback to basic processing
        return fallback_processing()

def fallback_processing():
    print("Using fallback processing...")
    # Implement fallback logic
    pass
```

These examples demonstrate the core functionality of Strataregula and its ecosystem. Start with the basic examples and gradually work your way up to more advanced use cases.