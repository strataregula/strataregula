# strataregula Claude Code 開発プロンプトテンプレート

## 現在のプロジェクト状況

### バージョン情報
- **現在バージョン**: v0.1.0 (MVP完成)
- **次期バージョン**: v0.2.0 (品質・テスト強化)
- **プロジェクト形式**: pyproject.toml (setuptools backend)

### 完成機能 (v0.1.0)
✅ **Enhanced Pattern Expansion Engine**: 47都道府県・8地域対応  
✅ **CLI統合**: `sr compile` (config_compiler.py後方互換)  
✅ **マルチ出力**: Python/JSON/YAML  
✅ **O(1)最適化**: 静的マッピング生成  
✅ **ストリーミング処理**: メモリ効率処理  
✅ **プロヴェナンス追跡**: 完全なトレーサビリティ  

### 技術スペック
- **処理能力**: 13パターン → 179サービス (<10ms)
- **メモリ使用**: ~44MB ピーク使用量
- **サポート階層**: 47都道府県 → 8地域 + サービス + ロール
- **テスト状況**: 21/21 パターン展開テスト合格

---

## 次回実装用プロンプトテンプレート

### SR-2実装: 包括的テストスイート作成

```markdown
# strataregula SR-2実装依頼

## コンテキスト
strataregula v0.1.0 (MVP完成版) の包括的テストスイート作成をお願いします。
現在のテスト状況: core/test_pattern_expander.py (21/21合格) のみ

## 前提条件
- **必ず `.development-rules.md` を最初に読み、ルールに従ってください**
- 現在バージョン: 0.1.0 → 新規: 0.1.1
- pyproject.toml準拠の開発環境

## 実装内容：SR-2（包括的テストスイート作成）

### 必須テストファイル作成
1. `tests/cli/test_main.py` - CLI統合テスト
2. `tests/cli/test_compile_command.py` - compile コマンドテスト
3. `tests/core/test_config_compiler.py` - ConfigCompilerテスト
4. `tests/integration/test_end_to_end.py` - E2Eテスト
5. `tests/performance/test_large_scale.py` - パフォーマンステスト

### テスト要件
- **カバレッジ目標**: 90% (pyproject.toml設定済み)
- **テストフレームワーク**: pytest + pytest-cov
- **マーカー使用**: @pytest.mark.integration, @pytest.mark.performance
- **モック使用**: 外部依存（ファイルI/O等）

### 具体的テストケース

#### CLI統合テスト
```python
def test_sr_compile_help():
    """sr compile --help が正常動作"""
    
def test_sr_compile_basic():
    """基本的なコンパイル処理"""
    
def test_sr_compile_formats():
    """全出力形式（Python/JSON/YAML）テスト"""
    
def test_sr_compile_error_handling():
    """エラー処理・異常系テスト"""
```

#### ConfigCompilerテスト
```python
def test_pattern_expansion_accuracy():
    """パターン展開精度テスト"""
    
def test_template_generation():
    """テンプレート生成テスト"""
    
def test_provenance_tracking():
    """プロヴェナンス追跡テスト"""
```

#### パフォーマンステスト
```python
@pytest.mark.performance
def test_large_config_processing():
    """大規模設定処理テスト (>1000パターン)"""
    
@pytest.mark.performance  
def test_memory_efficiency():
    """メモリ使用量テスト (≤200MB)"""
```

### テスト実行環境
- **Python**: 3.11+ (pyproject.toml指定)
- **依存関係**: pytest, pytest-cov, pytest-mock
- **実行コマンド**: `pytest --cov=strataregula --cov-report=term-missing`
- **CI準備**: GitHub Actions対応

## バージョン更新タスク
- [ ] pyproject.toml: version = "0.1.1"
- [ ] strataregula/__init__.py: __version__ = "0.1.1"  
- [ ] .development-rules.md: CURRENT_VERSION: 0.1.1
- [ ] CHANGELOG.md: [Unreleased] → [0.1.1] セクション追加

## 完了条件
- [ ] 全テスト合格 (pytest実行成功)
- [ ] カバレッジ90%達成
- [ ] パフォーマンステスト基準クリア
- [ ] CI設定準備完了
- [ ] バージョン統一完了
- [ ] CHANGELOG.md更新完了

## 重要な注意事項
- 既存機能を破壊しないよう注意
- 実際のファイル生成をテスト (例: examples/を使用)
- メモリリーク検出機能追加
- テスト実行時間最適化
- 型チェック（mypy --strict）対応
```

### SR-3実装: CI/CD自動化

```markdown  
# strataregula SR-3実装依頼

## コンテキスト  
v0.1.1 (テスト完備版) のCI/CD自動化をお願いします。

## 実装内容：SR-3（GitHub Actions CI/CD）
- `.github/workflows/ci.yml` - 継続的インテグレーション
- `.github/workflows/release.yml` - 自動リリース  
- `pre-commit-config.yaml` - 開発者フック
- バージョン: 0.1.1 → 0.1.2

[詳細仕様...]
```

---

## 汎用プロンプトテンプレート

```markdown
# strataregula SR-<番号>実装依頼

## コンテキスト
strataregula v<現在バージョン> の<機能名>実装をお願いします。

## 前提条件  
- **必ず `.development-rules.md` を最初に読み、開発ルールに従ってください**
- 現在バージョン: <現在> → 新規: <新バージョン>
- プロジェクト設定: pyproject.toml準拠

## 実装内容：SR-<番号>（<機能名>）
[具体的実装要求]

## バージョン更新タスク
- [ ] pyproject.toml: version = "<新バージョン>"
- [ ] strataregula/__init__.py: __version__ = "<新バージョン>"
- [ ] .development-rules.md: CURRENT_VERSION: <新バージョン>  
- [ ] CHANGELOG.md: 新セクション追加

## 品質基準
- [ ] テスト合格 (pytest)
- [ ] 型チェック合格 (mypy --strict)  
- [ ] リント合格 (ruff check)
- [ ] カバレッジ維持 (≥90%)

## 完了条件
[具体的な完了基準]
```

---

## 重要な開発原則

### 必須チェック項目
1. **`.development-rules.md`を最初に読む** - バージョン・ルール確認
2. **pyproject.toml準拠** - モダンなPython開発環境
3. **型安全性** - mypy strict準拠
4. **テスト駆動** - 機能追加前にテスト作成
5. **バージョン統一** - 4ファイル同期更新

### コミット規約
```
<type>(<scope>): <subject>

<body>

Refs: SR-<issue_number>
Version: <new_version>
```

### PR命名
`SR-<番号> | <機能名> | v<バージョン>`

---

このテンプレートを使用して、一貫性のある高品質な開発を継続してください。